---
title: 'Exercise #1'
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    code_download: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
```

```{r libraries}
library(tidyverse)
library(tidymodels)
library(naniar)
library(vip)
library(lubridate)
```

```{r theme}
theme_set(theme_minimal())
```

```{r data}
hotels <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-11/hotels.csv')
```

## Exercise 1: Setting Up Git and Github in rStudio

Create Repository for Assignment 1. Link: [https://github.com/michaelhetlo/Homework_1_ADR]

## Exercise 2: Create Website

### a) Link of Website

[https://michaelhelton.netlify.app/]

### b) Podcast Reflection

NEED TO DO

### c) Custom ggplot2

OPTIONAL DO IF HAVE TIME

## Exercise 3: Modeling Review and Intro to tidymodels

### 1. a) Without doing any analysis, what are some variables you think might be predictive and why?
Hotel (type), arrival_date_month, booking_changes.  Hotel type will be important as individuals traveling for work related purposes I assume will be less likely to cancel reservations, while people on vacation would be more likely to cancel.  So I think 'City Hotel' will have less cancellations. arrival_date_month might be predictive for the same reason as hotel, trying to figure out who is traveling for work versus pleasure.  booking_changes, I assume the higher the changes the less likely someone is to cancel, as the reason they might cancel is less strict because they are booking around it rather than something that comes up that makes it impossible to go.

### b) What are some problems that might exist with the data? You might think about how it was collected and who did the collecting.
?

### c) If we construct a model, what type of conclusions will be able to draw from it? 
If families or individuals are more likely to cancel, times of year people are more likely to cancel.  I don't think we will find causation of why things are canceled or not, but we should be able to find some trends of when things are more likely canceled. 

### 2. Create some exploratory plots or table summaries of the data, concentrating most on relationships with the response variable. Keep in mind the response variable is numeric, 0 or 1. You may want to make it categorical (you also may not). Be sure to also examine missing values or other interesting values.

```{r}
hotels %>%
  group_by(is_canceled) %>%
  summarise(total = n())
```

```{r, fig.width=20}
hotels %>%
  filter(is_canceled == 1) %>%
  ggplot(aes(x= arrival_date_month)) +
  geom_bar()
```

Summer months show increase.

### 3. Mutations.

```{r}
hotels_mod <- hotels %>% 
  mutate(is_canceled = as.factor(is_canceled)) %>% 
  mutate(across(where(is.character), as.factor)) %>% 
  select(-arrival_date_year,
         -reservation_status,
         -reservation_status_date) %>% 
  add_n_miss() %>% 
  filter(n_miss_all == 0) %>% 
  select(-n_miss_all)

set.seed(494)
```

```{r}
hotels_split <- initial_split(hotels_mod, prop = .5)
```

```{r}
hotels_training <- training(hotels_split)
hotels_testing <- testing(hotels_split)
```

```{r}
fix_small <- function(x, na.rm=TRUE) (as.factor(ifelse(x == 0,0,1)))
fix_agents <- function(x, na.rm=TRUE) (as.factor(ifelse(x == 'NULL',0,1)))

test <- hotels_mod %>%
  mutate_at(c('children', 'babies', 'previous_cancellations'), fix_small) %>%
  mutate_at(c('agent', 'company'), fix_agents) %>%
  mutate(country = fct_lump_n(country, n = 5)) %>%
  select(children, babies, previous_cancellations, agent, company, country)
```


```{r}
fix_small <- function(x, na.rm=TRUE) (as.factor(ifelse(x == 0,0,1)))
fix_agents <- function(x, na.rm=TRUE) (as.factor(ifelse(x == 'NULL',0,1)))

hotels_recipe <- recipe(is.canceled ~ ., 
                       data = house_training) %>%
  step_mutate_at(c('children', 'babies', 'previous_cancellations'), fix_small) %>%
  step_mutate_at(c('agent', 'company'), fix_agents) %>%
  step_mutate(country = fct_lump_n(country, n = 5)) %>%
  step_normalize(all_nominal()) %>%
  step_dummy(all_predictors(), 
             -all_outcomes())
  
  
  step_mutate(grade = as.character(grade),
              grade = fct_relevel(
                        case_when(
                          grade %in% "1":"6"   ~ "below_average",
                          grade %in% "10":"13" ~ "high",
                          TRUE ~ grade
                        ),
                        "below_average","7","8","9","high"),
              basement = as.numeric(sqft_basement == 0),
              renovated = as.numeric(yr_renovated == 0),
              view = as.numeric(view == 0),
              waterfront = as.numeric(waterfront),
              age_at_sale = year(date) - yr_built)%>% 
  # Remove sqft_basement, yr_renovated, and yr_built
  step_rm(sqft_basement, 
          yr_renovated, 
          yr_built) %>% 
  # Create a month variable
  step_date(date, 
            features = "month") %>% 
  # Make these evaluative variables, not included in modeling
  update_role(all_of(c("id",
                       "date",
                       "zipcode", 
                       "lat", 
                       "long")),
              new_role = "evaluative") %>% 
  # Create indicator variables for factors/character/nominal
  # explicitly remove outcome, even though outcome isn't nominal
  # this is important in cases when we have a nominal output (eg. logistic)
  step_dummy(all_nominal(), 
             -all_outcomes(), 
             -has_role(match = "evaluative")) %>% 
  step_normalize(all_predictors(), 
                 -all_nominal())
```











